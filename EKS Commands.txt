EKS Commands

Brew tap weaveworks/tap

Brew install eksctl

eksctl create cluster --name wso2-apim --version 1.21 --region ap-south-1 --nodegroup-name wso2-apim-node-group --node-type c5.4xlarge --nodes 6 --tags "User=gayand@wso2.com"


helm dependency update advanced/am-pattern-3/ && helm install wso2-apim advanced/am-pattern-3 --version 4.0.0-1 --namespace wso2 --create-namespace

/Users/gayand/wso2/choreo-connect-1.1.0/k8s-artifacts/choreo-connect-with-apim/choreo-connect

Install the metrics server 

kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

HPA needs the metrics server to access server resource consumption.

HPA for Standard GW

kubectl autoscale deployment wso2am-pattern-3-am-gateway-deployment --cpu-percent=5 --min=1 --max=8 -n wso2

HPA for CC GW

kubectl autoscale deployment choreo-connect-deployment --cpu-percent=5 --min=1 --max=8 -n wso2

Jmeter test

CC

./jmeter.sh -n -t ~/demo/ca/perf/K8sPerfTest.jmx -Jtoken=eyJ4NXQiOiJOVGRtWmpNNFpEazNOalkwWXpjNU1tWm1PRGd3TVRFM01XWXdOREU1TVdSbFpEZzROemM0WkEiLCJraWQiOiJNell4TW1Ga09HWXdNV0kwWldObU5EY3hOR1l3WW1NNFpUQTNNV0kyTkRBelpHUXpOR00wWkdSbE5qSmtPREZrWkRSaU9URmtNV0ZoTXpVMlpHVmxOZ19SUzI1NiIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhZG1pbiIsImF1dCI6IkFQUExJQ0FUSU9OIiwiYXVkIjoiUUw3MXFWbkJRNFRJNlJEZng3eGJXWUFoQ2prYSIsIm5iZiI6MTY1Mjk0MjQ4NiwiYXpwIjoiUUw3MXFWbkJRNFRJNlJEZng3eGJXWUFoQ2prYSIsInNjb3BlIjoiZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS53c28yLmNvbTo0NDNcL29hdXRoMlwvdG9rZW4iLCJleHAiOjE2NTI5NDYwODYsImlhdCI6MTY1Mjk0MjQ4NiwianRpIjoiMWRlMTg3MDMtMDFiNS00MjI1LTgzYzAtYmVlZjE0ZDRiZjAyIn0.eGFD6DjNyQrZuianjxIF7uR57_ifmp8ws5SJABnQqblK0ThFHyK8-PE0-CjvoILRsFo19kSyJFlByVDnIoGVHCCLJOQO9D7nqVOXTSuOmhOC1Gq0BOcWhLKjmo7Wl6IXhUHqUF2seru38SltTtz36KzuS70xNJv9NIEq7Lu_Rn06gszZZy__csRmtQGcMVo_BH2sZa0Qef0FqAZLf2--4o4Be3KBlDR-UY3MUWXAgKSONs_EXAxTFmdXdtQqp_dpkYS8TC1cn-rOJVx2N1v2x8WqAYmIvGgi-U7GCrYPjkMxlFB0EkWU_wtCAb5qy6i_Pj0zkAUrsDqGbr17jMbofw -Jgateway_server=gw.cc.wso2.com -Japi_path=echo/1.0.0/abc -Jhttp_method=POST



./jmeter.sh -n -t ~/demo/ca/perf/K8sPerfTest.jmx -Jtoken=eyJ4NXQiOiJOVGRtWmpNNFpEazNOalkwWXpjNU1tWm1PRGd3TVRFM01XWXdOREU1TVdSbFpEZzROemM0WkEiLCJraWQiOiJNell4TW1Ga09HWXdNV0kwWldObU5EY3hOR1l3WW1NNFpUQTNNV0kyTkRBelpHUXpOR00wWkdSbE5qSmtPREZrWkRSaU9URmtNV0ZoTXpVMlpHVmxOZ19SUzI1NiIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhZG1pbiIsImF1dCI6IkFQUExJQ0FUSU9OIiwiYXVkIjoiUUw3MXFWbkJRNFRJNlJEZng3eGJXWUFoQ2prYSIsIm5iZiI6MTY1Mjk0MjQ4NiwiYXpwIjoiUUw3MXFWbkJRNFRJNlJEZng3eGJXWUFoQ2prYSIsInNjb3BlIjoiZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS53c28yLmNvbTo0NDNcL29hdXRoMlwvdG9rZW4iLCJleHAiOjE2NTI5NDYwODYsImlhdCI6MTY1Mjk0MjQ4NiwianRpIjoiMWRlMTg3MDMtMDFiNS00MjI1LTgzYzAtYmVlZjE0ZDRiZjAyIn0.eGFD6DjNyQrZuianjxIF7uR57_ifmp8ws5SJABnQqblK0ThFHyK8-PE0-CjvoILRsFo19kSyJFlByVDnIoGVHCCLJOQO9D7nqVOXTSuOmhOC1Gq0BOcWhLKjmo7Wl6IXhUHqUF2seru38SltTtz36KzuS70xNJv9NIEq7Lu_Rn06gszZZy__csRmtQGcMVo_BH2sZa0Qef0FqAZLf2--4o4Be3KBlDR-UY3MUWXAgKSONs_EXAxTFmdXdtQqp_dpkYS8TC1cn-rOJVx2N1v2x8WqAYmIvGgi-U7GCrYPjkMxlFB0EkWU_wtCAb5qy6i_Pj0zkAUrsDqGbr17jMbofw -Jgateway_server=gw.cc.wso2.com -Japi_path=pizzashack/1.0.0/menu -Jhttp_method=GET


Synapse GW


./jmeter.sh -n -t ~/demo/ca/perf/K8sPerfTest.jmx -Jtoken=eyJ4NXQiOiJOVGRtWmpNNFpEazNOalkwWXpjNU1tWm1PRGd3TVRFM01XWXdOREU1TVdSbFpEZzROemM0WkEiLCJraWQiOiJNell4TW1Ga09HWXdNV0kwWldObU5EY3hOR1l3WW1NNFpUQTNNV0kyTkRBelpHUXpOR00wWkdSbE5qSmtPREZrWkRSaU9URmtNV0ZoTXpVMlpHVmxOZ19SUzI1NiIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhZG1pbiIsImF1dCI6IkFQUExJQ0FUSU9OIiwiYXVkIjoiUUw3MXFWbkJRNFRJNlJEZng3eGJXWUFoQ2prYSIsIm5iZiI6MTY1Mjk0MjQ4NiwiYXpwIjoiUUw3MXFWbkJRNFRJNlJEZng3eGJXWUFoQ2prYSIsInNjb3BlIjoiZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS53c28yLmNvbTo0NDNcL29hdXRoMlwvdG9rZW4iLCJleHAiOjE2NTI5NDYwODYsImlhdCI6MTY1Mjk0MjQ4NiwianRpIjoiMWRlMTg3MDMtMDFiNS00MjI1LTgzYzAtYmVlZjE0ZDRiZjAyIn0.eGFD6DjNyQrZuianjxIF7uR57_ifmp8ws5SJABnQqblK0ThFHyK8-PE0-CjvoILRsFo19kSyJFlByVDnIoGVHCCLJOQO9D7nqVOXTSuOmhOC1Gq0BOcWhLKjmo7Wl6IXhUHqUF2seru38SltTtz36KzuS70xNJv9NIEq7Lu_Rn06gszZZy__csRmtQGcMVo_BH2sZa0Qef0FqAZLf2--4o4Be3KBlDR-UY3MUWXAgKSONs_EXAxTFmdXdtQqp_dpkYS8TC1cn-rOJVx2N1v2x8WqAYmIvGgi-U7GCrYPjkMxlFB0EkWU_wtCAb5qy6i_Pj0zkAUrsDqGbr17jMbofw -Jgateway_server=gateway.am.wso2.com -Japi_path=echo/1.0.0/abc -Jhttp_method=POST



./jmeter.sh -n -t ~/demo/ca/perf/K8sPerfTest.jmx -Jtoken=eyJ4NXQiOiJOVGRtWmpNNFpEazNOalkwWXpjNU1tWm1PRGd3TVRFM01XWXdOREU1TVdSbFpEZzROemM0WkEiLCJraWQiOiJNell4TW1Ga09HWXdNV0kwWldObU5EY3hOR1l3WW1NNFpUQTNNV0kyTkRBelpHUXpOR00wWkdSbE5qSmtPREZrWkRSaU9URmtNV0ZoTXpVMlpHVmxOZ19SUzI1NiIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhZG1pbiIsImF1dCI6IkFQUExJQ0FUSU9OIiwiYXVkIjoiUUw3MXFWbkJRNFRJNlJEZng3eGJXWUFoQ2prYSIsIm5iZiI6MTY1Mjk0MjQ4NiwiYXpwIjoiUUw3MXFWbkJRNFRJNlJEZng3eGJXWUFoQ2prYSIsInNjb3BlIjoiZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS53c28yLmNvbTo0NDNcL29hdXRoMlwvdG9rZW4iLCJleHAiOjE2NTI5NDYwODYsImlhdCI6MTY1Mjk0MjQ4NiwianRpIjoiMWRlMTg3MDMtMDFiNS00MjI1LTgzYzAtYmVlZjE0ZDRiZjAyIn0.eGFD6DjNyQrZuianjxIF7uR57_ifmp8ws5SJABnQqblK0ThFHyK8-PE0-CjvoILRsFo19kSyJFlByVDnIoGVHCCLJOQO9D7nqVOXTSuOmhOC1Gq0BOcWhLKjmo7Wl6IXhUHqUF2seru38SltTtz36KzuS70xNJv9NIEq7Lu_Rn06gszZZy__csRmtQGcMVo_BH2sZa0Qef0FqAZLf2--4o4Be3KBlDR-UY3MUWXAgKSONs_EXAxTFmdXdtQqp_dpkYS8TC1cn-rOJVx2N1v2x8WqAYmIvGgi-U7GCrYPjkMxlFB0EkWU_wtCAb5qy6i_Pj0zkAUrsDqGbr17jMbofw -Jgateway_server=gateway.am.wso2.com -Japi_path=pizzashack/1.0.0/menu -Jhttp_method=GET




Echo service

AWS

jmeter -n -t /home/ec2-user/K8sPerfTest.jmx -Jtoken=eyJ4NXQiOiJOVGRtWmpNNFpEazNOalkwWXpjNU1tWm1PRGd3TVRFM01XWXdOREU1TVdSbFpEZzROemM0WkEiLCJraWQiOiJNell4TW1Ga09HWXdNV0kwWldObU5EY3hOR1l3WW1NNFpUQTNNV0kyTkRBelpHUXpOR00wWkdSbE5qSmtPREZrWkRSaU9URmtNV0ZoTXpVMlpHVmxOZ19SUzI1NiIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhZG1pbiIsImF1dCI6IkFQUExJQ0FUSU9OIiwiYXVkIjoiWWFZa0NwZlR3NTV6SlhqdGN5RTBTNV9FaGNvYSIsIm5iZiI6MTY1MzYyNTM4NSwiYXpwIjoiWWFZa0NwZlR3NTV6SlhqdGN5RTBTNV9FaGNvYSIsInNjb3BlIjoiZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS53c28yLmNvbTo0NDNcL29hdXRoMlwvdG9rZW4iLCJleHAiOjE2NTM2Mjg5ODUsImlhdCI6MTY1MzYyNTM4NSwianRpIjoiNTkxZDg1ZGYtNmE1Mi00MTQ0LThlOGUtMDBhOGY1NDU5MzU5In0.An58DsDeWAQbpCAv6r9Xp2_ZPuMeh3PznGr0Jy5XLH7otjcV_0Lri8CCx_5QKt7GVmAYjlbyz60OebC_NhZzGBvqua8TD_8_1_8tAfEEFABE01oQDvc8RoNYwX-XA_XZZ-AZOUl7OqOqsQjinJ1KntiJiZ9cx7gr62DSLj8iPBqz5I_rCRSgSp1plUbrp0mOUfalvOc_pyxLKi_aoqiuAlpjzUwCUsX7qr0f1PqmFCgkX_Su8_y4AIOSDbgvsgLsRQvpKsLQdJK_0RAzjSUpWKoj_3CJPtxReonVXSoz4o_ezfL8ceC3QaFg_zf9HDfN99DyDC_6xm1xq34mR7wr9Q -Jgateway_server=gw.cc.wso2.com -Japi_path=echo/1.0.0/abc -Jhttp_method=POST


jmeter -n -t /home/ec2-user/K8sPerfTest.jmx -Jtoken=eyJ4NXQiOiJOVGRtWmpNNFpEazNOalkwWXpjNU1tWm1PRGd3TVRFM01XWXdOREU1TVdSbFpEZzROemM0WkEiLCJraWQiOiJNell4TW1Ga09HWXdNV0kwWldObU5EY3hOR1l3WW1NNFpUQTNNV0kyTkRBelpHUXpOR00wWkdSbE5qSmtPREZrWkRSaU9URmtNV0ZoTXpVMlpHVmxOZ19SUzI1NiIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhZG1pbiIsImF1dCI6IkFQUExJQ0FUSU9OIiwiYXVkIjoiWWFZa0NwZlR3NTV6SlhqdGN5RTBTNV9FaGNvYSIsIm5iZiI6MTY1MzYzMTU0MiwiYXpwIjoiWWFZa0NwZlR3NTV6SlhqdGN5RTBTNV9FaGNvYSIsInNjb3BlIjoiZGVmYXVsdCIsImlzcyI6Imh0dHBzOlwvXC9hbS53c28yLmNvbTo0NDNcL29hdXRoMlwvdG9rZW4iLCJleHAiOjE2NTM2MzUxNDIsImlhdCI6MTY1MzYzMTU0MiwianRpIjoiNGRjNDViN2UtODFlNS00ZDU3LTg4NTYtMzlkMWViNDk2NDA1In0.li96xj4IkpPp4dgjv0cIa2SBmrv3gL3lRx8YiOGTKEitBib9rc3QrD2jd1A3O2nTOneWre9ec1c5kzXRMoAUdh0PgbLwtH8KvOPskzHKBfpQbvgCGPhaU50zyvVw4ASXM9_eC1RnSIneVCmumbxZtG7hVK6PKd4tt3W6bx4Hl8S9TRq6a4ZyiIvNMKPvz3U-Q9VOB2MMrHRi-d3TSrRMQw8aYwtR6qnQWjNvitIVgH2XEO8A2N6VErgAFac1LS8C6weUqxPN2CKttV1A2Y-4zqSzQupPt7bxYbFGIFDEFDriksIA-ueNyQ1AwUNVvJWz_McQd69M3QBxyQUYFty2Dg -Jgateway_server=gateway.am.wso2.com -Japi_path=echo/1.0.0/abc -Jhttp_method=POST




